<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AI Quest - The Ultimate Challenge</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
    }

    *::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
    
    :root {
      --gold: #FFD700;
      --gold-dark: #B8860B;
      --green: #10b981;
      --red: #ef4444;
      --bg-dark: #08080c;
      --bg-card: rgba(255,255,255,0.03);
      --border: rgba(255,255,255,0.08);
      --text: #ffffff;
      --text-dim: #6b7280;
    }

    /* Team name styling - small "team" prefix, larger name */
    .team-label {
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
      white-space: nowrap;
    }
    .team-label .prefix {
      font-size: 0.85em;
      font-weight: 500;
      opacity: 0.75;
      text-transform: lowercase;
      letter-spacing: 0.02em;
    }
    .team-label .name {
      font-size: 1em;
      font-weight: 700;
    }
    
    html, body {
      height: 100%;
      overflow-x: hidden;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
    }

    html::-webkit-scrollbar,
    body::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Layout */
    .screen { 
      display: none; 
      min-height: 100vh; 
      padding: 40px; 
      position: relative;
      z-index: 1;
      overflow-y: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
    }

    .screen::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }

    .screen.active { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
    }
    
    /* Cards */
    .glass-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid var(--border);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }
    
    /* Buttons */
    .btn {
      padding: 12px 24px;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      transform: scale(1);
    }

    .btn:active {
      transform: scale(0.95);
      transition: transform 0.1s ease;
    }
    
    .btn-gold {
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      color: #000;
      box-shadow: 0 4px 25px rgba(255,215,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3);
    }
    
    .btn-gold:hover, .btn-gold:active {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(255,215,0,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
    }
    
    .btn-gold::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }
    
    .btn-gold:hover::after {
      transform: translateX(100%);
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border: 1px solid var(--border);
    }
    
    .btn-secondary:hover, .btn-secondary:active {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,215,0,0.3);
    }

    /* ===== INTRO ===== */
    .intro-content { text-align: center; padding-top: 80px; }

    .intro-greeting {
      font-size: clamp(2rem, 5.5vw, 3.2rem);
      font-weight: 900;
      background: linear-gradient(135deg, var(--gold) 0%, #FFA500 50%, var(--gold-dark) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 40px;
      letter-spacing: -0.02em;
      filter: drop-shadow(0 2px 10px rgba(255,215,0,0.3));
    }
    
    .logo-container {
      position: relative;
      width: 160px;
      height: 160px;
      margin: 0 auto 40px;
    }
    
    .logo-ring {
      position: absolute;
      inset: 0;
      border: 2px solid rgba(168,85,247,0.4);
      border-radius: 50%;
      animation: ringPulse 3s ease-in-out infinite;
    }
    
    .logo-ring:nth-child(2) {
      inset: -15px;
      border-color: rgba(6,182,212,0.3);
      animation-delay: -1s;
    }
    
    .logo-ring:nth-child(3) {
      inset: -30px;
      border-color: rgba(168,85,247,0.2);
      animation-delay: -2s;
    }
    
    @keyframes ringPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.5; }
    }
    
    .logo-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 70px;
      filter: drop-shadow(0 0 30px rgba(255,100,150,0.6)) 
              drop-shadow(0 0 60px rgba(255,100,150,0.4));
    }
    
    .title {
      font-size: clamp(1.8rem, 5vw, 3rem);
      font-weight: 900;
      letter-spacing: -0.03em;
      margin-bottom: 12px;
    }
    
    .title-ai {
      background: linear-gradient(135deg, #fff 0%, #888 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .title-quest {
      background: linear-gradient(135deg, var(--gold) 0%, #FFA500 50%, var(--gold-dark) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 2px 10px rgba(255,215,0,0.3));
    }

    .intro-teams {
      margin: 30px 0;
    }

    .intro-teams-label {
      font-size: 0.8rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-bottom: 12px;
    }

    .intro-teams-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      max-width: 700px;
      margin: 0 auto;
    }

    .intro-team-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 100px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      font-size: 0.85rem;
      font-weight: 600;
    }

    .intro-team-chip .team-icon {
      font-size: 1.1rem;
    }
    
    .tagline {
      color: var(--text-dim);
      font-size: 1rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      margin-bottom: 50px;
    }
    
    .stats-row {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 50px;
    }
    
    .stat-card {
      padding: 24px 36px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--gold) 0%, #FFA500 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stat-label {
      font-size: 0.8rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-top: 4px;
    }

    /* ===== GAME LAYOUT WITH SIDE PANEL ===== */
    .game-layout {
      display: flex;
      width: 100%;
      max-width: 1500px;
      gap: 16px;
      margin-top: 15px;
    }

    /* ===== SIDE PANEL ===== */
    .side-panel {
      width: 160px;
      flex-shrink: 0;
      position: sticky;
      top: 15px;
      max-height: calc(100vh - 60px);
      overflow: hidden;
    }

    .side-panel::-webkit-scrollbar {
      display: none;
    }

    .side-panel-header {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 2px;
    }

    .side-panel-title {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--gold);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .questions-grid {
      padding: 4px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 3px;
    }

    .q-tile {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      background: rgba(255,255,255,0.03);
      border: 1px solid transparent;
      padding: 6px 2px;
      position: relative;
      font-size: 0.7rem;
      min-height: 32px;
    }

    .q-tile:hover {
      background: rgba(255,255,255,0.08);
      border-color: rgba(255,215,0,0.3);
      transform: scale(1.05);
    }

    .q-tile:active {
      transform: scale(0.95) !important;
      transition: transform 0.1s ease;
    }

    .q-tile.active {
      background: rgba(255,215,0,0.15);
      border-color: var(--gold);
    }

    .q-tile.answered {
      background: rgba(16,185,129,0.15);
      border-color: rgba(16,185,129,0.5);
    }

    .q-tile.skipped {
      background: rgba(255,255,255,0.05);
      border-color: rgba(255,255,255,0.15);
    }

    .q-tile-num {
      font-weight: 700;
      font-size: 0.8rem;
      color: var(--text-dim);
      line-height: 1;
    }

    .q-tile.active .q-tile-num {
      color: var(--gold);
    }

    .q-tile.answered .q-tile-num {
      color: var(--green);
    }

    .q-tile-team {
      font-size: 0.4rem;
      font-weight: 600;
      margin-top: 1px;
      color: var(--text-dim);
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .q-tile-pts {
      font-weight: 700;
      margin-left: 2px;
    }

    .q-tile-pts.correct {
      color: #4ade80;
    }

    .q-tile-pts.wrong {
      color: #f87171;
    }

    .panel-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      padding: 4px 6px;
      border-top: 1px solid var(--border);
      margin-top: 2px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 2px;
      font-size: 0.5rem;
      color: var(--text-dim);
    }

    .legend-dot {
      width: 5px;
      height: 5px;
      border-radius: 2px;
    }

    .legend-dot.current {
      background: var(--gold);
    }

    .legend-dot.answered {
      background: var(--green);
    }

    .legend-dot.unanswered {
      background: rgba(255,255,255,0.2);
    }

    /* Last Answered Info */
    .last-answered-info {
      display: none;
    }

    .last-answered-label {
      color: var(--text-dim);
    }

    .last-answered-q {
      font-weight: 700;
      color: var(--gold);
      background: rgba(255,215,0,0.15);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .last-answered-detail {
      color: var(--text);
      font-weight: 600;
    }

    .last-answered-detail .arrow {
      color: var(--text-dim);
      margin: 0 4px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      min-width: 0;
    }

    /* ===== QUESTION ===== */
    .q-header {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 30px;
    }

    .q-header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: 16px;
      padding: 4px 0;
    }
    
    .q-progress { 
      width: 100%;
    }
    
    .q-count {
      font-size: 1.1rem;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }
    
    .q-count .current {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--gold);
    }
    
    .q-count .total {
      color: var(--text-dim);
    }
    
    .progress-track {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 100px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--gold) 0%, #FFA500 100%);
      border-radius: 100px;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 20px rgba(255,215,0,0.5);
    }

    .header-buttons {
      display: flex;
      gap: 10px;
      padding: 4px;
      margin: -4px;
    }
    
    .category-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 22px;
      background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,215,0,0.05) 100%);
      border: 1px solid rgba(255,215,0,0.25);
      border-radius: 100px;
      color: var(--gold);
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 16px;
    }
    
    .question-card {
      width: 100%;
      padding: 50px 40px 35px 40px;
      text-align: center;
      position: relative;
      margin-bottom: 20px;
      margin-top: 20px;
    }

    .question-card.compact {
      padding: 45px 35px 30px 35px;
      margin-bottom: 16px;
    }
    
    .q-number {
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 28px;
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      border-radius: 100px;
      font-size: 1.2rem;
      font-weight: 800;
      color: #000;
      box-shadow: 0 4px 20px rgba(255,215,0,0.3);
      z-index: 10;
    }
    
    .question-text {
      font-size: clamp(1.2rem, 2.5vw, 1.6rem);
      font-weight: 600;
      line-height: 1.5;
      margin-top: 5px;
      flex: 1;
      text-align: center;
    }

    /* Team Selection Display */
    .team-selection-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 40px;
      text-align: center;
      min-height: 450px;
    }

    .selection-avatar {
      font-size: 8rem;
      margin-bottom: 40px;
      animation: floatBounce 3s ease-in-out infinite;
      filter: drop-shadow(0 15px 40px rgba(0,0,0,0.5));
    }

    .selection-avatar img {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--gold);
    }

    @keyframes floatBounce {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-20px) scale(1.05); }
    }

    .selection-label {
      font-size: 1rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.35em;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .selection-team-name {
      font-size: 4rem;
      font-weight: 800;
      color: var(--gold);
      margin-bottom: 35px;
      text-shadow: 0 4px 30px rgba(255,215,0,0.4);
    }

    .team-prefix {
      font-size: 0.65em;
      font-weight: 500;
      color: rgba(255,255,255,0.6);
      text-transform: lowercase;
      letter-spacing: 0.05em;
      vertical-align: baseline;
    }

    .selection-instruction {
      font-size: 1.15rem;
      color: var(--text-dim);
      max-width: 450px;
      line-height: 1.7;
    }

    .question-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    /* Question Row with Expand Trigger */
    .question-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      width: 100%;
    }

    .expand-trigger {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      flex-shrink: 0;
    }

    .expand-trigger:hover {
      background: rgba(255,215,0,0.1);
      border-color: var(--gold);
    }

    .expand-trigger:hover .expand-chevron {
      color: var(--gold);
    }

    .expand-chevron {
      width: 24px;
      height: 24px;
      color: var(--text-dim);
      transition: transform 0.3s ease, opacity 0.3s ease, color 0.2s ease;
    }

    .expand-chevron.expanded {
      transform: translateY(3px);
      opacity: 0.7;
      color: var(--gold);
    }

    /* Options Container with Animation */
    .options-container {
      width: 100%;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s ease-out, opacity 0.25s ease-out;
      opacity: 0;
      padding: 0;
    }

    .options-container.show {
      max-height: 500px;
      opacity: 1;
      padding-top: 16px;
      transition: max-height 0.4s ease-out, opacity 0.3s ease-in, padding 0.2s ease;
    }

    /* Tiebreaker Screen */
    .tiebreaker-content {
      text-align: center;
      padding: 30px 20px;
      max-width: 1000px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: auto;
    }

    #tiebreaker.screen {
      justify-content: center;
    }

    .tie-icon {
      font-size: 4rem;
      margin-bottom: 16px;
      animation: shake 0.5s ease-in-out infinite alternate;
    }

    @keyframes shake {
      0% { transform: rotate(-5deg); }
      100% { transform: rotate(5deg); }
    }

    .tie-title {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--gold);
      margin-bottom: 8px;
      text-shadow: 0 4px 20px rgba(255,215,0,0.3);
    }

    .tie-subtitle {
      font-size: 1rem;
      color: var(--text-dim);
      margin-bottom: 30px;
    }

    .tiebreaker-grid {
      justify-content: center;
      max-width: 800px;
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
    }

    /* Tiebreaker Team Cards */
    .tiebreaker-team-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.03) 100%);
      border: 2px solid rgba(255,215,0,0.3);
      border-radius: 18px;
      padding: 20px 24px;
      text-align: center;
      min-width: 180px;
    }

    .tiebreaker-team-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .tiebreaker-team-card .team-icon {
      font-size: 2.5rem;
      margin-bottom: 0;
    }

    .tiebreaker-team-card .team-image {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255,215,0,0.3);
    }

    .tiebreaker-team-info {
      text-align: left;
    }

    .tiebreaker-team-name {
      font-size: 1.2rem;
      font-weight: 800;
      color: var(--text);
      margin-bottom: 2px;
    }

    .tiebreaker-team-score {
      font-size: 0.85rem;
      color: var(--gold);
      font-weight: 600;
    }

    .tiebreaker-team-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .tiebreaker-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .tiebreaker-btn:active {
      transform: scale(0.95);
    }

    .tiebreaker-btn.bonus {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
    }

    .tiebreaker-btn.bonus:hover {
      background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
      transform: scale(1.05);
    }

    .tiebreaker-btn.penalty {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
    }

    .tiebreaker-btn.penalty:hover {
      background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
      transform: scale(1.05);
    }

    .tiebreaker-pts {
      font-size: 1.3rem;
      font-weight: 800;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      width: 100%;
      margin-bottom: 20px;
    }
    
    .option-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 18px;
      transition: all 0.3s;
    }
    
    .option-card:hover, .option-card:active {
      border-color: rgba(255,215,0,0.3);
      transform: translateX(5px);
    }
    
    .option-letter {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      border-radius: 10px;
      font-weight: 700;
      font-size: 0.9rem;
      color: #000;
      flex-shrink: 0;
      box-shadow: 0 2px 10px rgba(255,215,0,0.2);
    }
    
    .option-text {
      font-size: 0.95rem;
      font-weight: 500;
    }
    
    .actions-row {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .nav-row {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
      justify-content: center;
    }

    .btn-sm {
      padding: 10px 18px;
      font-size: 0.85rem;
    }

    .scoring-info.compact {
      padding: 12px 20px;
      font-size: 0.8rem;
    }

    /* ===== TEAMS PANEL (VERTICAL RIGHT SIDE) ===== */
    .teams-panel {
      width: 220px;
      flex-shrink: 0;
      position: sticky;
      top: 15px;
      max-height: calc(100vh - 60px);
      overflow-y: auto;
      scrollbar-width: none;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
    }

    .teams-panel::-webkit-scrollbar {
      display: none;
    }

    .teams-panel-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 14px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .teams-strip {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .team-chip {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }

    .team-chip.leading {
      background: rgba(255,215,0,0.1);
      border-color: rgba(255,215,0,0.3);
    }

    .team-chip-rank {
      font-size: 0.8rem;
      color: var(--text-dim);
      min-width: 16px;
      flex-shrink: 0;
    }

    .team-chip-name {
      flex: 1;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text);
      min-width: 0;
      overflow: hidden;
    }

    .team-chip.leading .team-chip-name {
      color: var(--gold);
    }

    .team-chip-score {
      font-size: 1rem;
      font-weight: 700;
      color: var(--gold);
      min-width: 20px;
      text-align: right;
      flex-shrink: 0;
    }

    /* Transition animation for question change */
    .main-content {
      transition: opacity 0.3s ease, transform 0.3s ease;
      overflow-y: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
    }

    .main-content::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }

    .main-content.transitioning {
      opacity: 0;
      transform: translateX(30px);
    }

    .main-content.transitioning-in {
      opacity: 0;
      transform: translateX(-30px);
    }

    .btn-skip {
      background: rgba(255,255,255,0.06);
      color: var(--text-dim);
      border: 1px solid var(--border);
      padding: 14px 24px;
    }

    .btn-skip:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text);
    }
    
    .scoring-info {
      display: flex;
      gap: 40px;
      padding: 16px 28px;
      font-size: 0.9rem;
      color: var(--text-dim);
      width: 100%;
      justify-content: center;
    }

    /* Navigation Row */
    .nav-row {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .nav-row .btn {
      min-width: 160px;
    }
    
    .scoring-info strong {
      color: var(--gold);
      font-weight: 700;
    }

    /* Question Answered Info on Question Page */
    .question-answered-info {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 16px 28px;
      background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(16,185,129,0.03) 100%);
      border: 1px solid rgba(16,185,129,0.3);
      border-radius: 14px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .qa-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1rem;
    }

    .qa-item:not(:last-child)::after {
      content: '|';
      margin-left: 14px;
      color: rgba(255,255,255,0.2);
    }

    .qa-label {
      color: var(--text-dim);
      font-weight: 500;
    }

    .qa-value {
      font-weight: 700;
      color: var(--green);
    }

    .qa-value.negative {
      color: var(--red);
    }

    /* Continue Game Section */
    .continue-game-section {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    /* Current Turn Indicator in Teams Panel */
    .current-turn-indicator {
      background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,215,0,0.05) 100%);
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
      text-align: center;
    }

    .turn-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--gold);
      margin-bottom: 6px;
      font-weight: 600;
    }

    .turn-team {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .turn-avatar {
      font-size: 1.3rem;
    }

    .turn-avatar img {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      object-fit: cover;
    }

    .turn-name {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text);
    }

    /* ===== REVEAL + AWARD ===== */
    .reveal-content {
      width: 100%;
      max-width: 1100px;
      padding-top: 20px;
    }

    #reveal.screen {
      padding: 20px 40px;
    }

    /* Reveal Screen Side Panel for Current Turn */
    .reveal-side-panel {
      position: fixed;
      top: 40px;
      right: 40px;
      background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,215,0,0.05) 100%);
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 16px;
      padding: 16px 20px;
      text-align: center;
      z-index: 10;
    }

    .reveal-turn-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--gold);
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
    }

    .reveal-turn-team {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .reveal-turn-avatar {
      font-size: 1.5rem;
    }

    .reveal-turn-avatar img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      vertical-align: middle;
    }

    .reveal-turn-name {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
    }
    
    .answer-showcase {
      display: flex;
      align-items: center;
      gap: 40px;
      padding: 25px;
      margin-bottom: 20px;
      background: linear-gradient(135deg, rgba(16,185,129,0.08) 0%, rgba(16,185,129,0.02) 100%);
      border: 1px solid rgba(16,185,129,0.2);
    }
    
    .answer-image {
      width: 160px;
      height: 160px;
      border-radius: 20px;
      overflow: hidden;
      flex-shrink: 0;
      border: 3px solid rgba(16,185,129,0.3);
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(139,92,246,0.2));
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .answer-image .fallback-icon {
      font-size: 5rem;
      opacity: 0.8;
    }
    
    .answer-details { flex: 1; }
    
    .answer-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 18px;
      background: rgba(16,185,129,0.2);
      border: 1px solid rgba(16,185,129,0.3);
      border-radius: 100px;
      color: var(--green);
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 16px;
    }
    
    .answer-badge::before {
      content: 'âœ“';
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: var(--green);
      border-radius: 50%;
      color: white;
      font-size: 0.7rem;
    }
    
    .answer-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gold);
      margin-bottom: 12px;
    }
    
    .answer-desc {
      font-size: 1rem;
      color: #9ca3af;
      line-height: 1.7;
      text-align: left;
    }
    
    .assign-section {
      text-align: center;
    }
    
    .assign-title {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #e5e7eb;
    }
    
    .assign-subtitle {
      font-size: 0.95rem;
      color: var(--text-dim);
      margin-bottom: 30px;
    }
    
    /* Desktop Teams Grid with Hover */
    .teams-grid {
      display: flex;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 16px;
      padding: 10px;
    }

    .teams-grid.no-hover .team-hover {
      display: none !important;
      pointer-events: none !important;
    }
    
    .team-card {
      position: relative;
      width: 130px;
      padding: 24px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid var(--border);
      transform: scale(1);
      z-index: 1;
    }
    
    .team-card:hover {
      transform: translateY(-8px) scale(1.03);
      border-color: var(--gold);
      box-shadow: 
        0 15px 40px rgba(255,215,0,0.2),
        0 0 0 1px rgba(255,215,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.1);
      z-index: 10;
    }
    
    .team-card.selected {
      border-color: var(--gold);
      box-shadow: 0 0 30px rgba(255,215,0,0.4);
      transform: scale(1.03);
      z-index: 10;
    }
    
    .team-icon {
      font-size: 2.8rem;
      margin-bottom: 10px;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
      transition: transform 0.3s;
    }
    
    .team-card:hover .team-icon {
      transform: scale(1.15);
    }
    
    .team-name {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
      transition: color 0.3s;
    }
    
    .team-card:hover .team-name, .team-card.selected .team-name {
      color: var(--gold);
    }
    
    .team-score {
      font-size: 0.85rem;
      color: var(--text-dim);
    }
    
    /* Desktop Hover Overlay */
    .team-hover {
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(20,20,30,0.95) 100%);
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
      z-index: 5;
    }
    
    .team-card:hover .team-hover {
      opacity: 1;
      pointer-events: auto;
      z-index: 20;
    }
    
    .hover-team-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hover-team-image {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .hover-btn {
      width: 100%;
      padding: 12px 10px;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.15s ease;
      transform: scale(1);
      position: relative;
      z-index: 25;
      pointer-events: auto;
    }
    
    .hover-btn:hover {
      transform: scale(1.05);
      filter: brightness(1.1);
    }

    .hover-btn:active {
      transform: scale(0.95) !important;
      transition: transform 0.1s ease;
    }
    
    .hover-btn.correct {
      background: linear-gradient(135deg, var(--green) 0%, #059669 100%);
      color: white;
    }
    
    .hover-btn.wrong {
      background: linear-gradient(135deg, var(--red) 0%, #dc2626 100%);
      color: white;
    }

    /* Team Image Support */
    .team-image {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
      transition: transform 0.3s;
    }

    .team-card:hover .team-image {
      transform: scale(1.15);
    }
    
    /* Mobile Action Panel */
    .mobile-action-panel {
      display: none;
      margin-top: 16px;
      padding: 20px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(255,215,0,0.03) 100%);
      border: 1px solid rgba(255,215,0,0.2);
    }

    /* Current Team Card - Single team display on reveal screen */
    .current-team-card {
      background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(255,215,0,0.03) 100%);
      border: 2px solid rgba(255,215,0,0.3);
      border-radius: 20px;
      padding: 20px 28px;
      text-align: center;
      max-width: 380px;
      margin: 0 auto;
    }

    .current-team-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      margin-bottom: 16px;
    }

    .current-team-card .team-icon {
      font-size: 3rem;
      margin-bottom: 0;
    }

    .current-team-card .team-image {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgba(255,215,0,0.3);
    }

    .current-team-info {
      text-align: left;
    }

    .current-team-name {
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--gold);
      margin-bottom: 2px;
    }

    .current-team-score {
      font-size: 0.9rem;
      color: var(--text-dim);
    }

    .current-team-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .score-btn {
      padding: 16px 20px;
      border: none;
      border-radius: 14px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .score-btn:active {
      transform: scale(0.95);
    }

    .score-btn.correct {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
    }

    .score-btn.correct:hover {
      background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
      transform: scale(1.03);
    }

    .score-btn.wrong {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
    }

    .score-btn.wrong:hover {
      background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
      transform: scale(1.03);
    }

    .score-pts {
      font-size: 1.6rem;
      font-weight: 800;
    }

    .score-label {
      font-size: 0.85rem;
      font-weight: 600;
      opacity: 0.9;
    }
    
    .selected-team-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .selected-team-icon { font-size: 2rem; }
    .selected-team-img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
    .selected-team-name { font-size: 1.2rem; font-weight: 700; color: var(--gold); }
    
    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .action-btn {
      padding: 20px 16px;
      border: none;
      border-radius: 16px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      transform: scale(1);
    }
    
    .action-btn .pts {
      font-size: 1.8rem;
      font-weight: 800;
    }
    
    .action-btn .label {
      font-size: 0.9rem;
      font-weight: 600;
      opacity: 0.9;
    }
    
    .action-btn.correct {
      background: linear-gradient(135deg, var(--green) 0%, #059669 100%);
      color: white;
      box-shadow: 0 8px 30px rgba(16,185,129,0.3);
    }
    
    .action-btn.wrong {
      background: linear-gradient(135deg, var(--red) 0%, #dc2626 100%);
      color: white;
      box-shadow: 0 8px 30px rgba(239,68,68,0.3);
    }
    
    .action-btn:hover {
      transform: translateY(-3px) scale(1.02);
    }

    .action-btn:active {
      transform: scale(0.95) !important;
      transition: transform 0.1s ease;
    }

    /* Already Answered Display */
    .already-answered {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 40px;
      background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(255,215,0,0.03) 100%);
      border: 2px solid rgba(255,215,0,0.3);
      border-radius: 20px;
      margin: 20px auto;
      max-width: 400px;
    }

    .answered-label {
      font-size: 0.85rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 16px;
    }

    .answered-team {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .answered-team-icon {
      font-size: 3rem;
    }

    .answered-team-image {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
    }

    .answered-team-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gold);
    }

    .answered-result {
      padding: 8px 16px;
      border-radius: 100px;
      font-weight: 700;
      font-size: 0.9rem;
    }

    .answered-result.correct {
      background: rgba(16,185,129,0.2);
      color: var(--green);
      border: 1px solid rgba(16,185,129,0.3);
    }

    .answered-result.wrong {
      background: rgba(239,68,68,0.2);
      color: var(--red);
      border: 1px solid rgba(239,68,68,0.3);
    }
    
    .nav-btns {
      display: flex;
      gap: 12px;
      margin-top: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* ===== MODAL ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    
    .modal {
      padding: 32px;
      border-radius: 24px;
      max-width: 400px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
    }

    .modal::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
    
    .modal-title {
      font-size: 1.4rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 24px;
      color: var(--gold);
    }
    
    .modal-teams {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 24px;
    }
    
    .modal-team {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 18px;
      border-radius: 14px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
    }
    
    .modal-team.top {
      background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,215,0,0.05) 100%);
      border-color: rgba(255,215,0,0.3);
    }
    
    .modal-rank { font-size: 1.3rem; width: 32px; }
    .modal-icon { font-size: 1.5rem; }
    .modal-name { flex: 1; font-weight: 600; }
    .modal-pts { color: var(--gold); font-weight: 700; font-size: 1.1rem; }

    /* Edit Score Modal */
    .edit-score-modal {
      max-width: 500px;
      width: 90%;
    }

    .edit-field {
      margin-bottom: 20px;
    }

    .edit-label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-dim);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .edit-team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 8px;
    }

    .edit-team-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 8px;
      background: rgba(255,255,255,0.05);
      border: 2px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      color: var(--text);
    }

    .edit-team-btn:hover {
      background: rgba(255,255,255,0.1);
    }

    .edit-team-btn.selected {
      border-color: var(--gold);
      background: rgba(255,215,0,0.1);
    }

    .edit-team-btn .team-icon {
      font-size: 1.5rem;
    }

    .edit-team-btn .team-name {
      font-size: 0.8rem;
      font-weight: 600;
    }

    .edit-points-btns {
      display: flex;
      gap: 12px;
    }

    .edit-points-btn {
      flex: 1;
      padding: 16px 20px;
      border: 2px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 1.3rem;
      font-weight: 700;
      transition: all 0.2s;
      color: var(--text);
    }

    .edit-points-btn.positive {
      background: rgba(16,185,129,0.1);
    }

    .edit-points-btn.positive:hover, .edit-points-btn.positive.selected {
      background: rgba(16,185,129,0.25);
      border-color: var(--green);
    }

    .edit-points-btn.negative {
      background: rgba(239,68,68,0.1);
    }

    .edit-points-btn.negative:hover, .edit-points-btn.negative.selected {
      background: rgba(239,68,68,0.25);
      border-color: var(--red);
    }

    .edit-summary {
      padding: 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 0.95rem;
    }

    .edit-summary .pts-change {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .edit-summary .pts-change.positive { color: var(--green); }
    .edit-summary .pts-change.negative { color: var(--red); }

    .edit-actions {
      display: flex;
      gap: 10px;
    }

    .edit-actions .btn {
      flex: 1;
    }

    /* ===== TOAST ===== */
    .toast {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(-200px);
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 32px;
      border-radius: 100px;
      background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(20,20,30,0.95) 100%);
      border: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      z-index: 2000;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
      opacity: 0;
      visibility: hidden;
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
      visibility: visible;
    }
    
    .toast-icon { font-size: 2.5rem; }
    .toast-text { font-size: 1.1rem; font-weight: 600; }
    .toast-pts { font-size: 1.5rem; font-weight: 800; }
    .toast-pts.pos { color: var(--green); }
    .toast-pts.neg { color: var(--red); }
    .toast-pts.zero { color: var(--text-dim); }

    /* ===== CONFETTI ===== */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
      overflow: hidden;
    }
    
    .confetti {
      position: absolute;
      top: -20px;
      opacity: 0;
      animation: confettiFall 4s ease-out forwards;
    }
    
    .confetti.active {
      opacity: 1;
    }
    
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /* ===== WINNER ===== */
    .winner-content {
      text-align: center;
      padding: 15px 20px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .trophy-container {
      position: relative;
      margin-bottom: 8px;
    }
    
    .trophy-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, rgba(255,215,0,0.4) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      animation: trophyGlow 2s ease-in-out infinite;
    }
    
    @keyframes trophyGlow {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.4; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.6; }
    }
    
    .trophy-icon {
      font-size: 4rem;
      position: relative;
      filter: drop-shadow(0 0 30px rgba(255,215,0,0.5));
      animation: trophyBounce 1.5s ease-in-out infinite;
    }
    
    @keyframes trophyBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    .winner-label {
      font-size: 0.75rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-bottom: 2px;
    }
    
    .champion-title {
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      font-weight: 900;
      background: linear-gradient(135deg, var(--gold) 0%, #FFA500 50%, var(--gold-dark) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 15px;
      letter-spacing: 0.05em;
    }
    
    .winner-showcase {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      padding: 50px 80px;
      border-radius: 28px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.5);
      min-width: 280px;
    }
    
    .winner-icon { font-size: 6rem; margin-bottom: 16px; }
    .winner-image { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 16px; }
    .winner-name { font-size: 2.8rem; font-weight: 800; color: #000; }
    .winner-score { font-size: 1.4rem; color: rgba(0,0,0,0.6); margin-top: 6px; }
    
    .winner-layout {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 80px;
      margin-bottom: 30px;
      width: 100%;
      max-width: 1100px;
    }
    
    .leaderboard-side {
      text-align: left;
      flex-shrink: 0;
    }
    
    .final-title {
      font-size: 1rem;
      color: #9ca3af;
      margin-bottom: 14px;
    }
    
    .final-leaderboard {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 280px;
      max-width: 320px;
    }
    
    .final-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 18px;
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
    }
    
    .final-row.gold {
      background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,215,0,0.05) 100%);
      border-color: rgba(255,215,0,0.3);
    }
    .final-row.silver {
      background: linear-gradient(135deg, rgba(192,192,192,0.08) 0%, rgba(192,192,192,0.02) 100%);
      border-color: rgba(192,192,192,0.2);
    }
    .final-row.bronze {
      background: linear-gradient(135deg, rgba(205,127,50,0.08) 0%, rgba(205,127,50,0.02) 100%);
      border-color: rgba(205,127,50,0.2);
    }
    
    .final-rank { font-size: 1rem; min-width: 28px; }
    .final-icon { display: none; }
    .final-image { display: none; }
    .final-name { flex: 1; font-weight: 600; font-size: 1rem; text-align: left; }
    .final-score { color: var(--gold); font-weight: 700; font-size: 1rem; }

    /* Mobile toggle for side panel */
    .panel-toggle {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--gold);
      border: none;
      color: #000;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(255,215,0,0.4);
    }

    /* ===== MOBILE RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .game-layout {
        flex-direction: column;
      }

      .side-panel {
        position: fixed;
        top: 0;
        left: -100%;
        width: 200px;
        height: 100vh;
        max-height: 100vh;
        z-index: 200;
        background: var(--bg-dark);
        border-right: 1px solid var(--border);
        transition: left 0.3s ease;
      }

      .side-panel.show {
        left: 0;
      }

      .teams-panel {
        display: none;
      }

      .panel-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 150;
      }

      .panel-overlay.show {
        display: block;
      }

      .panel-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .main-content {
        width: 100%;
      }
    }

    @media (max-width: 768px) {
      .screen { padding: 20px; }
      
      /* Hide desktop hover overlay on mobile */
      .team-hover { display: none !important; }
      
      /* Show mobile action panel */
      .mobile-action-panel { display: none; }
      .mobile-action-panel.show { display: block; }
      
      /* Intro */
      .intro-content { padding-top: 40px; }
      .logo-container { width: 120px; height: 120px; margin-bottom: 30px; }
      .logo-icon { font-size: 50px; }
      .logo-ring:nth-child(2) { inset: -10px; }
      .logo-ring:nth-child(3) { inset: -20px; }
      .title { font-size: 2.5rem; }
      .tagline { font-size: 0.7rem; letter-spacing: 0.2em; margin-bottom: 30px; }
      .stats-row { flex-direction: row; gap: 10px; flex-wrap: wrap; justify-content: center; }
      .stat-card { padding: 16px 20px; min-width: 90px; }
      .stat-value { font-size: 1.8rem; }
      .stat-label { font-size: 0.7rem; }
      
      /* Question */
      .q-header { gap: 10px; margin-bottom: 20px; }
      .q-header-top { flex-wrap: wrap; gap: 10px; }
      .q-count .current { font-size: 1.4rem; }
      .header-buttons { gap: 6px; }
      .header-buttons .btn { padding: 8px 12px; font-size: 0.75rem; }
      .category-badge { padding: 8px 16px; font-size: 0.8rem; }
      .question-card { padding: 45px 20px 25px 20px; margin-bottom: 20px; margin-top: 15px; }
      .q-number { padding: 8px 20px; font-size: 1rem; top: -15px; }
      .question-text { font-size: 1.2rem; }
      
      /* Team Selection Mobile */
      .team-selection-display { padding: 50px 20px; min-height: 350px; }
      .selection-avatar { font-size: 5rem; margin-bottom: 25px; }
      .selection-avatar img { width: 100px; height: 100px; }
      .selection-label { font-size: 0.85rem; }
      .selection-team-name { font-size: 2.8rem; margin-bottom: 25px; }
      .selection-instruction { font-size: 1rem; }
      
      /* Options Toggle Mobile */
      .expand-trigger { width: 38px; height: 38px; }
      .expand-chevron { width: 20px; height: 20px; }
      
      /* Tiebreaker Mobile */
      .tiebreaker-content { padding: 30px 15px; }
      .tie-icon { font-size: 3.5rem; }
      .tie-title { font-size: 2rem; }
      .tie-subtitle { font-size: 0.95rem; margin-bottom: 30px; }
      .tiebreaker-grid { max-width: 100%; }
      
      .options-grid { grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px; }
      .option-card { padding: 14px 16px; gap: 12px; }
      .option-letter { width: 36px; height: 36px; font-size: 0.9rem; }
      .option-text { font-size: 0.95rem; }
      .actions-row { flex-direction: column; gap: 12px; width: 100%; max-width: 400px; }
      .actions-row .btn { width: 100%; }
      .nav-row { flex-direction: row; gap: 10px; width: 100%; max-width: 400px; }
      .nav-row .btn { flex: 1; padding: 12px 16px; font-size: 0.85rem; }
      .nav-row { flex-direction: row; gap: 10px; width: 100%; max-width: 400px; }
      .nav-row .btn { min-width: auto; flex: 1; padding: 14px 16px; font-size: 0.9rem; }
      .scoring-info { flex-direction: column; gap: 8px; text-align: center; padding: 14px 20px; font-size: 0.8rem; }
      
      /* Question answered info mobile */
      .question-answered-info {
        flex-direction: column;
        gap: 12px;
        text-align: center;
        padding: 14px 20px;
      }
      
      .qa-item { font-size: 0.85rem; }
      .qa-label { font-size: 0.85rem; }
      .qa-value { font-size: 0.85rem; }
      
      /* Reveal */
      .reveal-content { padding-top: 15px; }
      .reveal-side-panel {
        position: fixed;
        top: auto;
        bottom: 20px;
        right: 20px;
        padding: 10px 14px;
        border-radius: 12px;
      }
      .reveal-turn-label { font-size: 0.6rem; margin-bottom: 4px; }
      .reveal-turn-avatar { font-size: 1.2rem; }
      .reveal-turn-avatar img { width: 24px; height: 24px; }
      .reveal-turn-name { font-size: 0.9rem; }
      .answer-showcase { flex-direction: column; text-align: center; padding: 20px; gap: 16px; margin-bottom: 20px; }
      .answer-image { width: 100px; height: 100px; }
      .answer-image .fallback-icon { font-size: 3rem; }
      .answer-title { font-size: 1.3rem; }
      .answer-desc { font-size: 0.85rem; }
      .answer-badge { padding: 6px 14px; font-size: 0.75rem; margin-bottom: 10px; }
      .assign-title { font-size: 1rem; }
      .assign-subtitle { font-size: 0.75rem; margin-bottom: 12px; }
      
      /* Mobile team grid - simple selection */
      .teams-grid { 
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        width: 100%;
        margin-bottom: 16px;
      }
      .team-card { 
        width: 100%; 
        padding: 10px 6px; 
        border-radius: 12px;
      }
      .team-icon { font-size: 1.6rem; margin-bottom: 2px; }
      .team-name { font-size: 0.65rem; }
      .team-score { font-size: 0.6rem; }
      
      /* Modal */
      .modal { padding: 24px; border-radius: 20px; }
      .modal-title { font-size: 1.2rem; margin-bottom: 16px; }
      .modal-team { padding: 12px 14px; gap: 10px; }
      .modal-rank { font-size: 1.1rem; width: 28px; }
      .modal-icon { font-size: 1.2rem; }
      .modal-name { font-size: 0.9rem; }
      .modal-pts { font-size: 1rem; }
      
      /* Toast */
      .toast { padding: 14px 24px; gap: 12px; top: 20px; }
      .toast-icon { font-size: 2rem; }
      .toast-text { font-size: 1rem; }
      .toast-pts { font-size: 1.3rem; }
      
      /* Winner */
      .winner-content { padding-top: 30px; }
      .trophy-icon { font-size: 5rem; }
      .trophy-glow { width: 150px; height: 150px; }
      .winner-label { font-size: 0.85rem; }
      .champion-title { font-size: 2.5rem; margin-bottom: 30px; }
      .winner-layout { gap: 150px; }
      .winner-showcase { padding: 60px 100px; }
      .winner-icon { font-size: 7rem; margin-bottom: 20px; }
      .winner-image { width: 140px; height: 140px; }
      .winner-name { font-size: 3.2rem; }
      .winner-score { font-size: 1.5rem; }
      .final-title { font-size: 1.1rem; margin-bottom: 16px; }
    }

    @media (max-width: 900px) {
      .winner-layout { gap: 50px; }
      .winner-showcase { padding: 40px 60px; }
      .winner-icon { font-size: 5rem; }
      .winner-name { font-size: 2.2rem; }
      .final-leaderboard { min-width: 220px; }
    }

    @media (max-width: 600px) {
      .winner-layout {
        flex-direction: column;
        gap: 30px;
      }
      .leaderboard-side {
        text-align: center;
      }
      .final-leaderboard {
        align-items: center;
      }
      .winner-showcase {
        padding: 40px 60px;
      }
      .winner-icon { font-size: 5rem; }
      .winner-name { font-size: 2rem; }
      .winner-score { font-size: 1.1rem; }
    }
    
    @media (max-width: 400px) {
      .teams-grid { grid-template-columns: repeat(3, 1fr); gap: 6px; }
      .team-card { padding: 8px 4px; }
      .team-icon { font-size: 1.4rem; }
      .stats-row { gap: 8px; }
      .stat-card { padding: 14px 16px; min-width: 80px; }
    }
  </style>
</head>
<body>
  <!-- Confetti Container -->
  <div class="confetti-container" id="confettiContainer"></div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <span class="toast-icon" id="toastIcon"></span>
    <span class="toast-text" id="toastText"></span>
    <span class="toast-pts" id="toastPts"></span>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
    <div class="modal glass-card" onclick="event.stopPropagation()">
      <h2 class="modal-title">ðŸ“Š Current Standings</h2>
      <div class="modal-teams" id="modalTeams"></div>
      <button class="btn btn-gold" style="width:100%" onclick="closeModal()">Close</button>
    </div>
  </div>

  <!-- Edit Score Modal -->
  <div class="modal-overlay" id="editScoreModal" onclick="closeEditScoreModal()">
    <div class="modal glass-card edit-score-modal" onclick="event.stopPropagation()">
      <h2 class="modal-title">âœï¸ Edit Score for Q<span id="editQNum"></span></h2>
      
      <div class="edit-field">
        <label class="edit-label">Assign to Team:</label>
        <div class="edit-team-grid" id="editTeamGrid"></div>
      </div>
      
      <div class="edit-field">
        <label class="edit-label">Points:</label>
        <div class="edit-points-btns">
          <button class="edit-points-btn positive" id="editPts2" onclick="setEditPoints(2)">+2</button>
          <button class="edit-points-btn positive" id="editPts1" onclick="setEditPoints(1)">+1</button>
          <button class="edit-points-btn negative" id="editPtsMinus1" onclick="setEditPoints(-1)">-1</button>
        </div>
      </div>
      
      <div class="edit-summary" id="editSummary"></div>
      
      <div class="edit-actions">
        <button class="btn btn-secondary" onclick="closeEditScoreModal()">Cancel</button>
        <button class="btn btn-gold" onclick="saveEditScore()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Panel Overlay for mobile -->
  <div class="panel-overlay" id="panelOverlay" onclick="togglePanel()"></div>

  <!-- INTRO -->
  <div id="intro" class="screen active">
    <div class="intro-content">
      <p class="intro-greeting">Dear Sailr's, Happy 2026!</p>
      <div class="logo-container">
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>
        <div class="logo-ring"></div>
        <div class="logo-icon">ðŸ§ </div>
      </div>
      <h1 class="title">
        <span class="title-quest">Welcome to AI Quest</span>
      </h1>
      <button class="btn btn-gold" onclick="startGame()">Let's Begin!</button>
    </div>
  </div>

  <!-- QUESTION -->
  <div id="question" class="screen">
    <div class="game-layout">
      <!-- Side Panel - Questions -->
      <div class="side-panel glass-card" id="sidePanel">
        <div class="side-panel-header">
          <div class="side-panel-title">ðŸ“‹ Questions</div>
        </div>
        <div class="questions-grid" id="questionsGrid"></div>
        <div class="panel-legend">
          <div class="legend-item"><div class="legend-dot current"></div> Current</div>
          <div class="legend-item"><div class="legend-dot answered"></div> Answered</div>
          <div class="legend-item"><div class="legend-dot unanswered"></div> Pending</div>
        </div>
        <div class="last-answered-info" id="lastAnsweredInfo" style="display:none;">
          <span class="last-answered-label">Last Answered:</span>
          <span class="last-answered-q" id="lastAnsweredQ">Q1</span>
          <span class="last-answered-detail" id="lastAnsweredDetail">Alpha</span>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="q-header">
          <div class="q-header-top">
            <div class="q-count">
              <span class="current" id="qNum">0</span>
              <span class="total" id="qTotal">/ 26</span>
            </div>
            <div class="header-buttons">
              <button class="btn btn-gold btn-sm" onclick="endQuiz()">ðŸ† End Quiz</button>
            </div>
          </div>
          <div class="q-progress">
            <div class="progress-track">
              <div class="progress-fill" id="progressBar"></div>
            </div>
          </div>
        </div>
        
        <!-- Team Selection Display - shown when waiting for team to pick question -->
        <div class="team-selection-display" id="teamSelectionDisplay">
          <div class="selection-avatar" id="selectionAvatar">ðŸ¦</div>
          <div class="selection-label">CURRENT TURN</div>
          <div class="selection-team-name"><span class="team-prefix">Team</span> <span id="selectionTeamName">Alpha</span></div>
          <div class="selection-instruction">Please select a Question Number from the sidebar to begin.</div>
        </div>
        
        <!-- Question Content - shown after question is selected -->
        <div class="question-content" id="questionContent" style="display:none;">
          <div class="category-badge" id="category">ðŸ’¡ Category</div>
          
          <div class="question-card glass-card compact">
            <div class="q-number" id="qBadge">Q1</div>
            <div class="question-row">
              <h2 class="question-text" id="qText"></h2>
              <div class="expand-trigger" id="expandTrigger" onclick="toggleOptions()">
                <svg class="expand-chevron" id="expandChevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
          </div>
          
          <div class="options-container" id="optionsContainer">
            <div class="options-grid" id="optionsGrid"></div>
          </div>
          
          <!-- Show which team answered if already answered -->
          <div class="question-answered-info" id="questionAnsweredInfo" style="display:none;">
            <div class="qa-item"><span class="qa-label">Ans:</span> <span class="qa-value" id="qaAnswer"></span></div>
            <div class="qa-item"><span class="qa-label">Team:</span> <span class="qa-value" id="qaTeamName"></span></div>
            <div class="qa-item"><span class="qa-label">Score:</span> <span class="qa-value" id="qaPoints"></span></div>
          </div>
          
          <!-- Continue Game button for answered questions -->
          <div class="continue-game-section" id="continueGameSection" style="display:none;">
            <button class="btn btn-secondary btn-sm" onclick="openEditScoreModal()">âœï¸ Edit Score</button>
            <button class="btn btn-gold" onclick="continueGame()">Continue Game â†’</button>
          </div>
          
          <div class="actions-row" id="actionsRow">
            <button class="btn btn-gold btn-sm" onclick="showScreen('reveal')">Reveal Answer â†’</button>
          </div>
          
          <div class="scoring-info glass-card compact" id="scoringInfo">
            <div>âœ¨ No options: <strong>+2</strong> / <strong>-1</strong></div>
            <div>ðŸ’¡ With options: <strong>+1</strong> / <strong>-1</strong></div>
          </div>
        </div>
      </div>

      <!-- Teams Panel (Right Side) -->
      <div class="teams-panel">
        <div class="current-turn-indicator" id="currentTurnIndicator">
          <div class="turn-label">Current Turn</div>
          <div class="turn-team">
            <span class="turn-avatar" id="turnAvatar">ðŸ¦</span>
            <span class="turn-name" id="turnName">Alpha</span>
          </div>
        </div>
        <div class="teams-panel-title">Scores</div>
        <div class="teams-strip" id="teamsStrip"></div>
      </div>
    </div>

    <!-- Mobile Panel Toggle -->
    <button class="panel-toggle" onclick="togglePanel()">ðŸ“‹</button>
  </div>

  <!-- REVEAL + AWARD -->
  <div id="reveal" class="screen">
    <!-- Fixed Current Turn Indicator on the side -->
    <div class="reveal-side-panel" id="revealTurnIndicator">
      <div class="reveal-turn-label">CURRENT TURN</div>
      <div class="reveal-turn-team">
        <span class="reveal-turn-avatar" id="revealTurnAvatar">ðŸ¦</span>
        <span class="reveal-turn-name"><span class="team-prefix">Team</span> <span id="revealTurnName">Alpha</span></span>
      </div>
    </div>
    
    <div class="reveal-content">
      <div class="answer-showcase glass-card">
        <div class="answer-image" id="ansImageContainer">
          <span class="fallback-icon" id="fallbackIcon">ðŸ¤–</span>
        </div>
        <div class="answer-details">
          <div class="answer-badge" id="ansBadge">Option C</div>
          <h2 class="answer-title" id="ansTitle"></h2>
          <p class="answer-desc" id="ansDesc"></p>
        </div>
      </div>
      
      <div class="assign-section">
        <div class="teams-grid" id="teamsGrid"></div>
        
        <!-- Mobile Action Panel - BIG BUTTONS -->
        <div class="mobile-action-panel" id="mobileActionPanel">
          <div class="selected-team-info">
            <span class="selected-team-icon" id="selectedTeamIcon"></span>
            <span class="selected-team-name" id="selectedTeamName"></span>
          </div>
          <div class="action-buttons">
            <button class="action-btn correct" onclick="awardSelected(true)">
              <span class="pts" id="correctPtsBtn">+2</span>
              <span class="label">Correct âœ“</span>
            </button>
            <button class="action-btn wrong" onclick="awardSelected(false)">
              <span class="pts" id="wrongPtsBtn">-1</span>
              <span class="label">Wrong âœ—</span>
            </button>
          </div>
        </div>
        
        <div class="nav-btns">
          <button class="btn btn-secondary" onclick="backToQuestion()">â† Back to Question</button>
          <button class="btn btn-secondary" id="nextQBtn" onclick="goNextQuestion()">Next Question â†’</button>
          <button class="btn btn-gold" onclick="endQuiz()">ðŸ† End Quiz</button>
        </div>
      </div>
    </div>
  </div>

  <!-- TIEBREAKER -->
  <div id="tiebreaker" class="screen">
    <div class="tiebreaker-content">
      <div class="tie-icon">âš”ï¸</div>
      <h1 class="tie-title">It's a Tie!</h1>
      <p class="tie-subtitle">These teams are tied! Assign bonus points to determine the winner.</p>
      
      <div class="teams-grid tiebreaker-grid" id="tiedTeamsGrid"></div>
    </div>
  </div>

  <!-- WINNER -->
  <div id="winner" class="screen">
    <div class="winner-content">
      <div class="trophy-container">
        <div class="trophy-glow"></div>
        <div class="trophy-icon">ðŸ†</div>
      </div>
      <p class="winner-label">And the winner is...</p>
      <h1 class="champion-title">CHAMPION</h1>
      
      <div class="winner-layout">
        <div class="winner-showcase" id="winnerCard">
          <div class="winner-icon" id="winIcon"></div>
          <div class="winner-name" id="winName"></div>
          <div class="winner-score" id="winScore"></div>
        </div>
        
        <div class="leaderboard-side">
          <h3 class="final-title">ðŸ† Final Leaderboard</h3>
          <div class="final-leaderboard" id="finalLeaderboard"></div>
        </div>
      </div>
      
      <button class="btn btn-gold" onclick="restart()">ðŸ”„ Restart Quest</button>
    </div>
  </div>

  <script>
    // Teams can have either 'icon' (emoji) or 'image' (URL) for their avatar
    // To use an image instead of emoji, add 'image' property with URL
    // Example: { id: 0, name: 'Alpha', score: 0, image: 'https://example.com/avatar.png', bg: '...' }
    const teams = [
      { id: 0, name: 'Kiran', score: 0, icon: 'ðŸ¦', bg: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)' },
      { id: 1, name: 'Pavan', score: 0, icon: 'ðŸ˜', bg: 'linear-gradient(135deg, #7F8C8D 0%, #566573 100%)' },
      { id: 2, name: 'Anil', score: 0, icon: 'ðŸ¦…', bg: 'linear-gradient(135deg, #3498DB 0%, #2980B9 100%)' },
      { id: 3, name: 'Narayana', score: 0, icon: 'ðŸ¯', bg: 'linear-gradient(135deg, #F39C12 0%, #D68910 100%)' },
      { id: 4, name: 'Srirag', score: 0, icon: 'ðŸ»â€â„ï¸', bg: 'linear-gradient(135deg, #85C1E9 0%, #5DADE2 100%)' },
      { id: 5, name: 'Bala', score: 0, icon: 'ðŸ¼', bg: 'linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%)' }
    ];

    // Helper function to get team avatar HTML (image or icon)
    function getTeamAvatar(team, className = 'team-icon') {
      if (team.image) {
        return `<img src="${team.image}" alt="${team.name}" class="team-image">`;
      }
      return `<div class="${className}">${team.icon}</div>`;
    }

    const questions = [
      { cat: 'AI Requirements', q: 'When a stakeholder says "this system must be intelligent," what is the most accurate interpretation?', opts: ['It should automate everything', 'It should replace humans', 'It should perform tasks that normally require human intelligence', 'It should replicate human thinking and emotions'], ans: 'It should perform tasks that normally require human intelligence', icon: 'ðŸ§ ', desc: 'In requirements and AI contexts, an "intelligent" system is one that can handle activities such as learning from data, reasoning, problem solving, or decision-making, which are typically associated with human intelligence, not one that fully automates everything, replaces humans, or replicates human emotions.\n\nExamples:\nâ€¢ Image recognition\nâ€¢ Language translation\nâ€¢ Medical diagnosis support' },
      { cat: 'Turing Test', q: 'If a system passes the Turing Test, what does it NOT guarantee?', opts: ['It can sound human', 'It can reason correctly', 'It can generate language', 'It can fool users'], ans: 'It can reason correctly', icon: 'ðŸ¤–', desc: 'The Turing Test measures appearance of intelligence, not correctness or understanding. Passing the Turing Test only shows that a system can use language in a way that fools human judges into thinking it is human (that it can "sound human" and "fool users"). It does not guarantee genuine reasoning ability or that its answers are logically or factually correct.\n\nExamples:\nâ€¢ ELIZA fooled users without understanding\nâ€¢ Modern chatbots can sound confident while hallucinating' },
      { cat: 'Machine Learning', q: 'A team says: "We\'ll use ML so we don\'t need rules." What are they underestimating?', opts: ['Infrastructure cost', 'Ongoing data quality and monitoring', 'UI complexity', 'Model size'], ans: 'Ongoing data quality and monitoring', icon: 'ðŸ“Š', desc: 'ML replaces explicit rules with patterns learned from data, which requires continuous monitoring. Using ML does not eliminate the need for rules; it often adds the need for new kinds of rules and processes around data quality checks, drift detection, labeling standards, and continuous monitoring of inputs and model performance over time. This means teams frequently underestimate how much ongoing work is required to keep data clean, stable, and reliable so the model continues to behave well in production.\n\nExamples:\nâ€¢ Spam filters degrading due to data drift\nâ€¢ Recommendation systems needing retraining' },
      { cat: 'Reinforcement Learning', q: 'Why is reinforcement learning risky outside controlled environments?', opts: ['It needs GPUs', 'Rewards can be poorly defined', 'Training is slow', 'Models are large'], ans: 'Rewards can be poorly defined', icon: 'ðŸŽ®', desc: 'Reinforcement learning optimizes exactly what is rewarded â€” not necessarily what is intended. Reinforcement learning is risky in the real world because if the reward function is even slightly mis-specified, the agent can learn harmful or unintended behaviors while still maximizing that flawed reward, leading to side effects, reward hacking, or unsafe exploration.\n\nExamples:\nâ€¢ AI gaming reward systems\nâ€¢ Systems exploiting unintended shortcuts' },
      { cat: 'Neural Networks', q: 'Why are neural networks hard to fully explain?', opts: ['They use too much data', 'They involve many non-linear transformations', 'They require GPUs', 'They retrain automatically'], ans: 'They involve many non-linear transformations', icon: 'ðŸ•¸ï¸', desc: 'Neural networks distribute logic across layers and weights, not explicit steps. Neural networks apply layers of non-linear activation functions to inputs, creating very complex internal representations that are hard to map to simple human-understandable rules. This layered non-linearity makes it difficult to trace exactly how any specific input leads to a particular output in a fully transparent way.\n\nExamples:\nâ€¢ Credit scoring models hard to audit\nâ€¢ Medical AI decisions difficult to justify step-by-step' },
      { cat: 'NLP', q: 'Which NLP failure is most harmful in production systems?', opts: ['High accuracy on common cases, poor performance on rare ones', 'Occasional grammar errors in long responses', 'Confident responses without reliable source grounding', 'Model refusals on ambiguous queries'], ans: 'Confident responses without reliable source grounding', icon: 'ðŸ’¬', desc: 'Users tolerate slowness or minor errors, but confident wrong answers destroy trust. In production, NLP systems that produce incorrect outputs while sounding highly confident can mislead users, spread misinformation, and cause serious harm, especially in high-stakes domains like health, finance, or security.\n\nExamples:\nâ€¢ Legal chatbots hallucinating case law\nâ€¢ Medical symptom checkers sounding certain but wrong' },
      { cat: 'Deep Learning', q: 'What does "deep" practically enable in neural networks?', opts: ['Faster training', 'Learning layered abstractions', 'Less data usage', 'Simpler models'], ans: 'Learning layered abstractions', icon: 'ðŸ“š', desc: 'Each layer learns progressively higher-level features. In practice, "deep" means stacking many layers so the network can build hierarchical representations: lower layers learn simple features, and higher layers combine them into more abstract concepts, enabling it to model very complex patterns.\n\nExamples:\nâ€¢ Vision: edges â†’ shapes â†’ objects\nâ€¢ Language: characters â†’ words â†’ meaning' },
      { cat: 'AGI vs Narrow AI', q: 'What is the key difference between Narrow AI and Artificial General Intelligence (AGI)?', opts: ['Speed', 'Programming language', 'Training data', 'Scope of cognitive abilities'], ans: 'Scope of cognitive abilities', icon: 'ðŸŒ', desc: 'Narrow AI is designed to perform specific, limited tasks, while Artificial General Intelligence (AGI) would be able to understand, learn, and apply knowledge across many domains with human-like flexibility and reasoning.\n\nExamples:\nâ€¢ Letting chatbots make policy decisions\nâ€¢ Assuming AI "understands" intent' },
      { cat: 'Algorithmic Bias', q: 'An AI matches historical data perfectly but produces biased outcomes. What failed?', opts: ['The model', 'The training process', 'The evaluation criteria', 'Infrastructure'], ans: 'The evaluation criteria', icon: 'âš–ï¸', desc: 'Accuracy against past data does not guarantee fairness. The model and training process did what they were asked to doâ€”fit historical dataâ€”but the evaluation failed to check for fairness, bias, and downstream impact, so biased behavior was not detected or prevented.\n\nExamples:\nâ€¢ Hiring systems reinforcing gender bias\nâ€¢ Lending models replicating redlining' },
      { cat: 'Data Ethics', q: 'What is the most immediate ethical risk of AI trained on real-world data?', opts: ['Energy usage', 'Job loss', 'Amplifying existing bias', 'Sentience'], ans: 'Amplifying existing bias', icon: 'âš ï¸', desc: 'AI scales whatever patterns exist in data â€” including harmful ones. When AI is trained on real-world data, it can inherit and then amplify historical and societal biases present in that data, leading to systematically unfair or discriminatory outcomes for certain groups.\n\nExamples:\nâ€¢ Predictive policing\nâ€¢ Unequal healthcare recommendations' },
      { cat: 'Computer Vision', q: 'Why should AI systems that analyze medical images not operate fully autonomously?', opts: ['High latency', 'Model size', 'Risk of false confidence', 'Infrastructure cost'], ans: 'Risk of false confidence', icon: 'ðŸ¥', desc: 'Medical imaging AI systems often output predictions with high confidence scores that can mislead clinicians into over-relying on them, even when the model is wrong due to edge cases, poor generalization, or unseen data distributions. Human oversight is essential to catch these errors and provide context-specific judgment that AI lacks. Autonomous operation amplifies harm potential in diagnostics where missing a lesion or false positive can directly impact patient treatment.\n\nExamples:\nâ€¢ Missed fractures delaying treatment\nâ€¢ False positives leading to unnecessary procedures' },
      { cat: 'Turing Test', q: 'What problem does the Turing Test not help us evaluate today?', opts: ['Human-like conversation', 'Logical correctness', 'Language fluency', 'Ability to fool users'], ans: 'Logical correctness', icon: 'ðŸ¤–', desc: 'The Turing Test evaluates whether a machine can engage in human-like conversation through text, focusing on indistinguishability from a human rather than verifying the factual accuracy, logical validity, or reasoning depth of its responses. Modern AI systems routinely pass variants of it by mimicking fluency and deception, but they can still produce logically flawed or incorrect outputs without detection by the test.\n\nExamples:\nâ€¢ ELIZA fooled users without understanding\nâ€¢ Modern chatbots can pass conversation but hallucinate facts' },
      { cat: 'Activation Functions', q: 'What is the main purpose of an activation function in a neural network?', opts: ['Adjust weights during training', 'Introduce non-linearity', 'Calculate total error', 'Initialize parameters'], ans: 'Introduce non-linearity', icon: 'âš¡', desc: 'Without non-linearity, multiple layers behave like a single layer.\n\nExamples:\nâ€¢ ReLU\nâ€¢ Sigmoid\nâ€¢ Tanh' },
      { cat: 'Unsupervised Learning', q: 'Why is unsupervised learning risky for direct business decisions?', opts: ['Low accuracy', 'Harder to validate correctness', 'High compute cost', 'Poor UX'], ans: 'Harder to validate correctness', icon: 'ðŸ”', desc: 'Without ground truth, interpretation becomes subjective. Unsupervised learning identifies patterns like clusters or anomalies without labeled ground truth, making it challenging to confirm if those patterns accurately represent reality or useful business insights. Without clear validation metrics or human judgment, these outputs risk leading to misguided decisions such as flawed customer segments or undetected errors. In contrast, supervised methods have explicit accuracy checks against known labels.\n\nExamples:\nâ€¢ Customer clusters that look logical but aren\'t actionable\nâ€¢ Segments shifting with new data' },
      { cat: 'Large Language Models', q: 'What distinguishes Large Language Models (LLMs) from earlier NLP systems?', opts: ['Single-task specialization', 'Hard-coded grammar rules', 'Massive scale of parameters and training data', 'Ability to train on personal computers'], ans: 'Massive scale of parameters and training data', icon: 'ðŸ“š', desc: 'Large Language Models (LLMs) like GPT series differ from traditional NLP by using billions or trillions of parameters trained on internet-scale text corpora, enabling emergent generalization across tasks via transformer architectures. Earlier systems relied on smaller models with rule-based parsing, statistical features, or task-specific training that couldn\'t capture broad contextual understanding.\n\nExamples:\nâ€¢ GPT-style models\nâ€¢ Internet-scale training data' },
      { cat: 'ImageNet', q: 'What major project co-founded by Dr. Fei-Fei Li advanced computer vision?', opts: ['AlphaGo', 'MNIST', 'CIFAR-10', 'ImageNet'], ans: 'ImageNet', icon: 'ðŸ–¼ï¸', image: 'images/fei_fei_li.jpg', desc: 'Dr. Fei-Fei Li co-founded ImageNet, a massive, labeled image dataset that fueled the deep learning (Data driven learning) revolution in computer vision through the annual ImageNet challenge.\n\nExamples:\nâ€¢ 14M+ labeled images\nâ€¢ Standard benchmarking across researchers' },
      { cat: 'AI Pioneers', q: 'Who coined the term "Artificial Intelligence"?', opts: ['Marvin Minsky', 'Alan Turing', 'John McCarthy', 'Geoffrey Hinton'], ans: 'John McCarthy', icon: 'ðŸŽ“', image: 'images/john_mccarthy.jpg', desc: 'John McCarthy coined the term "Artificial Intelligence" in his 1955 proposal for the Dartmouth Conference, which is widely regarded as the birthplace of AI as a field.\n\nExamples:\nâ€¢ Shift from philosophy to engineering discipline' },
      { cat: 'AI Awards', q: 'In 2025, the Queen Elizabeth Prize for Engineering was awarded for contributions to modern AI/machine learning. How many individuals received the prize, and how many are women?', opts: ['6 recipients; 1 woman', '7 recipients; 1 woman', '7 recipients; 2 women', '8 recipients; 2 women'], ans: '7 recipients; 1 woman', icon: 'ðŸ†', image: 'images/qe_prize.png', desc: 'The 2025 Queen Elizabeth Prize for Engineering was awarded to seven engineers for their seminal contributions to modern machine learning, a cornerstone of AI research and application.' },
      { cat: 'AI Milestones', q: 'AlphaGo defeated which world champion?', opts: ['Garry Kasparov', 'Ke Jie', 'Fan Hui', 'Lee Sedol'], ans: 'Lee Sedol', icon: 'âš«', image: 'images/lee_sedol.jpg', desc: 'Lee Sedol was an 18-time world champion and one of the strongest Go players in history. The match took place in 2016, and AlphaGo won 4â€“1. At the time, Go was considered out of reach for computers because it relies heavily on intuition and pattern recognition, not brute-force calculation.' },
      { cat: 'AI Milestones', q: 'What did AlphaGo defeating the world champion in the Go Game demonstrate?', opts: ['Humans are obsolete', 'Narrow AI can exceed experts in bounded domains', 'AGI is near', 'Strategy games are solved'], ans: 'Narrow AI can exceed experts in bounded domains', icon: 'ðŸŽ¯', desc: 'AlphaGo was exceptional at Go â€” and only Go. It did not understand strategy in general, couldn\'t play chess, and couldn\'t transfer its learning to other domains. This is the hallmark of Narrow AI: extreme competence within a clearly defined problem space.' },
      { cat: 'AI History', q: 'Which system defeated Garry Kasparov in chess?', opts: ['Deep Blue', 'AlphaZero', 'Stockfish', 'Watson'], ans: 'Deep Blue', icon: 'â™Ÿï¸', image: 'images/kasparov_deep_blue.jpg', desc: 'Deep Blue, built by IBM, defeated Garry Kasparov, the reigning world chess champion, in 1997. This was the first time a computer beat a world champion in a classical match under standard tournament conditions. The win marked a milestone for computing power, not machine learning.' },
      { cat: 'AI History', q: 'How was Deep Blue fundamentally different from AlphaGo?', opts: ['Used learning', 'Relied on brute-force search', 'Generalized intelligence', 'Autonomous reasoning'], ans: 'Relied on brute-force search', icon: 'ðŸ”', desc: 'Deep Blue used brute-force search and pre-programmed evaluation functions to analyze millions of positions per second. AlphaGo, in contrast, used deep learning and reinforcement learning to develop intuition-like pattern recognition, representing a fundamental shift in AI approach.' },
      { cat: 'AI Ethics', q: 'What is the 30% Rule in AI?', opts: ['AI must be accurate 30% of the time', 'AI should replace 30% of human jobs', 'AI should assist humans, but humans must make the final decisions', 'AI models should be trained on 30% data'], ans: 'AI should assist humans, but humans must make the final decisions', icon: 'âš–ï¸', image: 'images/bhargavi.png', desc: 'The 30% rule in AI means AI-generated content should not exceed about 30%, while human thinking, judgment, and decisions must make up the rest. This ensures humans remain in control of critical decisions.' },
      { cat: 'AI Concepts', q: 'Artificial General Intelligence (AGI) refers to:', opts: ['Supervised learning', 'Augmented intelligence', 'Narrow AI', 'Human-level general intelligence'], ans: 'Human-level general intelligence', icon: 'ðŸ§ ', desc: 'AGI describes a hypothetical AI that can understand, learn, and apply intelligence across a wide range of tasks, the way humans do. Unlike today\'s AI, AGI would be able to transfer knowledge from one domain to another without being retrained from scratch.' },
      { cat: 'AI Safety', q: 'When an AI model generates false information with high confidence, this is called:', opts: ['Overfitting', 'Hallucination', 'Underfitting', 'Regularization'], ans: 'Hallucination', icon: 'ðŸ‘»', desc: 'Hallucination occurs when AI models produce outputs that sound plausible but are factually incorrect or entirely fabricated. This is particularly dangerous in high-stakes domains like healthcare, law, and finance where users may trust confident-sounding but false information.\n\nExamples:\nâ€¢ Chatbots inventing fake legal citations\nâ€¢ AI generating non-existent research papers' },
      { cat: 'Transformers', q: 'What architectural innovation made modern LLMs like GPT possible?', opts: ['Convolutional layers', 'Recurrent connections', 'Self-attention mechanism', 'Pooling operations'], ans: 'Self-attention mechanism', icon: 'ðŸ”„', image: 'images/transformer.png', desc: 'The Transformer architecture, introduced in the 2017 paper "Attention Is All You Need," uses self-attention to process all input tokens in parallel and capture long-range dependencies. This replaced sequential processing in RNNs, enabling massive parallelization and scaling to billions of parameters.\n\nExamples:\nâ€¢ GPT series\nâ€¢ BERT\nâ€¢ All modern LLMs' },
      { cat: 'Transfer Learning', q: 'Why is transfer learning valuable in AI development?', opts: ['It eliminates the need for data', 'It allows models to leverage knowledge from one task to improve performance on another', 'It makes models smaller', 'It removes bias from training'], ans: 'It allows models to leverage knowledge from one task to improve performance on another', icon: 'ðŸ”€', desc: 'Transfer learning enables a model trained on a large dataset to be fine-tuned for a specific task with much less data. This dramatically reduces training time, compute costs, and data requirements while achieving strong performance.\n\nExamples:\nâ€¢ Fine-tuning GPT for customer service\nâ€¢ Adapting ImageNet models for medical imaging' },
      { cat: 'Explainable AI', q: 'Why is Explainable AI (XAI) critical in regulated industries?', opts: ['It makes models faster', 'It reduces training costs', 'It enables humans to understand and audit AI decisions', 'It eliminates all errors'], ans: 'It enables humans to understand and audit AI decisions', icon: 'ðŸ”', desc: 'In regulated industries like healthcare, finance, and criminal justice, decisions must be explainable and auditable. XAI techniques help stakeholders understand why an AI made a specific decision, which is essential for compliance, trust, and identifying potential biases or errors.\n\nExamples:\nâ€¢ Loan approval explanations required by law\nâ€¢ Medical diagnosis rationale for doctors' },
      { cat: 'Prompt Engineering', q: 'What is the primary goal of prompt engineering?', opts: ['To train new models from scratch', 'To craft inputs that guide AI models toward desired outputs', 'To reduce model size', 'To eliminate hallucinations completely'], ans: 'To craft inputs that guide AI models toward desired outputs', icon: 'âœï¸', desc: 'Prompt engineering involves designing and refining the text inputs given to AI models to elicit more accurate, relevant, and useful responses. It has become a critical skill as LLMs are highly sensitive to how questions and instructions are framed.\n\nExamples:\nâ€¢ Chain-of-thought prompting for reasoning\nâ€¢ Few-shot examples for consistency' },
      { cat: 'AI Governance', q: 'What is the main purpose of AI governance frameworks?', opts: ['To make AI development faster', 'To establish accountability, transparency, and ethical guidelines for AI systems', 'To replace human decision-makers', 'To reduce computing costs'], ans: 'To establish accountability, transparency, and ethical guidelines for AI systems', icon: 'ðŸ“‹', desc: 'AI governance frameworks define policies, standards, and oversight mechanisms to ensure AI systems are developed and deployed responsibly. They address risks like bias, privacy violations, and lack of accountability while promoting beneficial AI use.\n\nExamples:\nâ€¢ EU AI Act regulations\nâ€¢ Corporate AI ethics boards\nâ€¢ Model risk management policies' }
    ];

    // Track question states
    const questionStates = questions.map(() => ({
      answered: false,
      skipped: false,
      teamId: null,
      correct: null,
      optionsUsed: false,
      turnTeamId: null
    }));

    let currentQ = 0;
    let optionsShown = false;
    let optionsUsed = false;
    let selectedTeamId = null;
    let confettiShown = false;
    let confettiRunning = false;
    let currentTeamIndex = 0;
    let questionRevealed = false;
    let lastAnsweredQ = -1;

    const $ = id => document.getElementById(id);
    const getLetter = i => String.fromCharCode(65 + i);
    const getRank = i => ['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£','7ï¸âƒ£'][i] || '';
    const getSorted = () => [...teams].sort((a,b) => b.score - a.score);
    const isMobile = () => window.innerWidth <= 1024;

    function showScreen(id) {
      const currentScreen = document.querySelector('.screen.active');
      const targetScreen = $(id);
      
      if (currentScreen === targetScreen) {
        if (id === 'question') {
          if (!questionRevealed) showTeamSelection();
          else updateQuestion();
        }
        if (id === 'reveal') updateReveal();
        if (id === 'winner') updateWinner();
        if (id === 'tiebreaker') updateTiebreaker();
        return;
      }
      
      // No animation for reveal - just show it instantly
      if (id === 'reveal') {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        targetScreen.classList.add('active');
        updateReveal();
        return;
      }
      
      // Handle reveal to question transition (Back to Question) - no animation
      if (currentScreen && currentScreen.id === 'reveal' && id === 'question') {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        targetScreen.classList.add('active');
        if (questionRevealed) updateQuestion();
        else showTeamSelection();
        return;
      }
      
      // Default transition for other screens (intro, winner, tiebreaker)
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      targetScreen.classList.add('active');
      if (id === 'question') {
        if (!questionRevealed) showTeamSelection();
        else updateQuestion();
      }
      if (id === 'reveal') updateReveal();
      if (id === 'winner') updateWinner();
      if (id === 'tiebreaker') updateTiebreaker();
    }

    function startGame() {
      teams.forEach(t => t.score = 0);
      questionStates.forEach(s => {
        s.answered = false;
        s.skipped = false;
        s.teamId = null;
        s.correct = null;
        s.optionsUsed = false;
        s.points = 0;
        s.turnTeamId = null;
      });
      currentQ = 0;
      optionsShown = false;
      optionsUsed = false;
      currentTeamIndex = 0;
      questionRevealed = false;
      lastAnsweredQ = -1;
      showScreen('question');
    }

    function showTeamSelection() {
      questionRevealed = false;
      $('teamSelectionDisplay').style.display = 'flex';
      $('questionContent').style.display = 'none';
      
      // Update team display
      const team = teams[currentTeamIndex];
      $('selectionTeamName').textContent = team.name;
      
      // Handle image or icon
      if (team.image) {
        $('selectionAvatar').innerHTML = `<img src="${team.image}" alt="${team.name}">`;
      } else {
        $('selectionAvatar').innerHTML = team.icon || 'ðŸŽ¯';
      }
      
      updateSidePanel();
      updateLiveLeaderboard();
      updateCurrentTurnIndicator();
      
      // Update progress
      const completed = questionStates.filter(s => s.answered || s.skipped).length;
      $('progressBar').style.width = (completed / questions.length * 100) + '%';
      $('qNum').textContent = completed;
    }

    function revealQuestion(index) {
      if (questionStates[index].answered) return;
      
      currentQ = index;
      questionRevealed = true;
      optionsShown = false;
      optionsUsed = false;
      
      $('teamSelectionDisplay').style.display = 'none';
      $('questionContent').style.display = 'flex';
      
      // Reset options
      $('optionsContainer').classList.remove('show');
      $('expandChevron').classList.remove('expanded');
      
      updateQuestion();
    }

    function continueGame() {
      // Don't advance team - just return to team selection for current team
      // Team advancement only happens after actually answering a question (in award function)
      questionRevealed = false;
      showTeamSelection();
    }

    function updateCurrentTurnIndicator() {
      const team = teams[currentTeamIndex];
      const turnAvatar = $('turnAvatar');
      const turnName = $('turnName');
      
      if (team.image) {
        turnAvatar.innerHTML = `<img src="${team.image}" alt="${team.name}">`;
      } else {
        turnAvatar.innerHTML = team.icon || 'ðŸŽ¯';
      }
      turnName.innerHTML = `<span class="team-label"><span class="prefix">Team</span> <span class="name">${team.name}</span></span>`;
    }

    function updateSidePanel() {
      const grid = $('questionsGrid');
      grid.innerHTML = questions.map((q, i) => {
        const state = questionStates[i];
        let statusClass = '';
        let teamHtml = '';

        if (state.answered) {
          statusClass = 'answered';
          const team = teams.find(t => t.id === state.teamId);
          if (team) {
            const ptsDisplay = state.points > 0 ? `+${state.points}` : state.points;
            teamHtml = `<div class="q-tile-team"><span class="team-label"><span class="prefix">Team</span> <span class="name">${team.name}</span></span> <span class="q-tile-pts ${state.correct ? 'correct' : 'wrong'}">${ptsDisplay}</span></div>`;
          }
        } else if (state.skipped) {
          statusClass = 'skipped';
        }

        // Only show active when question is revealed
        if (i === currentQ && questionRevealed) statusClass += ' active';

        return `
          <div class="q-tile ${statusClass}" onclick="goToQuestion(${i})" title="Q${i + 1}: ${q.cat}">
            <div class="q-tile-num">${i + 1}</div>
            ${teamHtml}
          </div>
        `;
      }).join('');
      
      updateLastAnsweredInfo();
    }

    function updateLastAnsweredInfo() {
      const infoEl = $('lastAnsweredInfo');
      if (lastAnsweredQ < 0) {
        infoEl.style.display = 'none';
        return;
      }
      
      const state = questionStates[lastAnsweredQ];
      const answeredByTeam = teams.find(t => t.id === state.teamId);
      const turnTeam = teams.find(t => t.id === state.turnTeamId);
      
      if (answeredByTeam) {
        $('lastAnsweredQ').textContent = 'Q' + (lastAnsweredQ + 1);
        
        if (turnTeam && turnTeam.id !== answeredByTeam.id) {
          // Different team answered than whose turn it was
          // Case 2: "Beta â†’ Zeta"
          $('lastAnsweredDetail').innerHTML = `<span class="team-label"><span class="prefix">Team</span> <span class="name">${turnTeam.name}</span></span> <span class="arrow">â†’</span> <span class="team-label"><span class="prefix">Team</span> <span class="name">${answeredByTeam.name}</span></span>`;
        } else {
          // Same team answered their own question
          // Case 1: "Alpha"
          $('lastAnsweredDetail').innerHTML = `<span class="team-label"><span class="prefix">Team</span> <span class="name">${answeredByTeam.name}</span></span>`;
        }
        infoEl.style.display = 'flex';
      }
    }

    function goToQuestion(index) {
      // If question is already answered, show the question info (read-only view)
      if (questionStates[index].answered) {
        currentQ = index;
        questionRevealed = true;
        $('teamSelectionDisplay').style.display = 'none';
        $('questionContent').style.display = 'flex';
        updateQuestion();
        if (isMobile()) togglePanel();
        return;
      }
      
      // If we're in team selection mode, reveal the question
      if (!questionRevealed) {
        revealQuestion(index);
        if (isMobile()) togglePanel();
        return;
      }
      
      // If a different question is clicked while another is revealed, switch to it
      if (index !== currentQ) {
        revealQuestion(index);
        if (isMobile()) togglePanel();
        return;
      }
    }

    function togglePanel() {
      $('sidePanel').classList.toggle('show');
      $('panelOverlay').classList.toggle('show');
    }

    function updateQuestion() {
      const q = questions[currentQ];
      const state = questionStates[currentQ];
      
      $('qNum').textContent = currentQ + 1;
      
      // Calculate progress based on answered + skipped questions
      const completed = questionStates.filter(s => s.answered || s.skipped).length;
      $('progressBar').style.width = (completed / questions.length * 100) + '%';
      
      $('category').innerHTML = 'ðŸ’¡ ' + q.cat;
      $('qBadge').textContent = 'Q' + (currentQ + 1);
      $('qText').textContent = q.q;
      
      // Build options
      $('optionsGrid').innerHTML = q.opts.map((opt, i) => `
        <div class="option-card glass-card">
          <div class="option-letter">${getLetter(i)}</div>
          <div class="option-text">${opt}</div>
        </div>
      `).join('');
      
      // Reset options state
      $('optionsContainer').classList.remove('show');
      $('expandChevron').classList.remove('expanded');
      optionsShown = false;
      
      // Show answered info if question was already answered
      const answeredInfo = $('questionAnsweredInfo');
      const actionsRow = $('actionsRow');
      const scoringInfo = $('scoringInfo');
      const continueSection = $('continueGameSection');
      
      if (state.answered) {
        const team = teams.find(t => t.id === state.teamId);
        
        // Show the correct answer
        $('qaAnswer').textContent = q.ans;
        
        // Show team name
        $('qaTeamName').innerHTML = `<span class="team-label"><span class="prefix">Team</span> <span class="name">${team.name}</span></span>`;
        
        // Calculate and show points
        const pts = state.points || (state.correct ? (state.optionsUsed ? +1 : +2) : -1);
        const pointsEl = $('qaPoints');
        pointsEl.textContent = (pts > 0 ? '+' : '') + pts;
        pointsEl.className = 'qa-value ' + (pts < 0 ? 'negative' : '');
        
        answeredInfo.style.display = 'flex';
        continueSection.style.display = 'flex';
        actionsRow.style.display = 'none';
        scoringInfo.style.display = 'none';
      } else {
        answeredInfo.style.display = 'none';
        continueSection.style.display = 'none';
        actionsRow.style.display = 'flex';
        scoringInfo.style.display = 'flex';
      }
      
      updateSidePanel();
      updateLiveLeaderboard();
      updateCurrentTurnIndicator();
    }

    function updateLiveLeaderboard() {
      const strip = $('teamsStrip');
      if (!strip) return;
      
      const maxScore = Math.max(...teams.map(t => t.score));
      
      // Keep teams in original order, just highlight the leader
      strip.innerHTML = teams.map((t, i) => `
        <div class="team-chip ${t.score > 0 && t.score === maxScore ? 'leading' : ''}">
          <span class="team-chip-rank">${i + 1}</span>
          <span class="team-chip-name"><span class="team-label"><span class="prefix">Team</span> <span class="name">${t.name}</span></span></span>
          <span class="team-chip-score">${t.score}</span>
        </div>
      `).join('');
    }

    function toggleOptions() {
      optionsShown = !optionsShown;
      const container = $('optionsContainer');
      const arrow = $('expandChevron');
      
      if (optionsShown) {
        optionsUsed = true;
        questionStates[currentQ].optionsUsed = true;
        container.classList.add('show');
        arrow.classList.add('expanded');
      } else {
        container.classList.remove('show');
        arrow.classList.remove('expanded');
      }
    }

    function goPrevious() {
      if (currentQ > 0) {
        animateToQuestion(currentQ - 1, 'left');
      }
    }

    function goNext() {
      if (currentQ < questions.length - 1) {
        animateToQuestion(currentQ + 1, 'right');
      }
    }

    function animateToQuestion(targetQ, direction) {
      const mainContent = document.querySelector('.main-content');
      // For 'right' (next): current goes left (-50), new comes from right (+50)
      // For 'left' (prev): current goes right (+50), new comes from left (-50)
      const slideOut = direction === 'right' ? '-50px' : '50px';
      const slideIn = direction === 'right' ? '50px' : '-50px';
      
      // Animate out
      mainContent.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
      mainContent.style.opacity = '0';
      mainContent.style.transform = `translateX(${slideOut})`;
      
      setTimeout(() => {
        currentQ = targetQ;
        optionsShown = false;
        optionsUsed = questionStates[currentQ].optionsUsed || false;
        updateQuestion();
        
        // Set up for animate in
        mainContent.style.transition = 'none';
        mainContent.style.transform = `translateX(${slideIn})`;
        
        // Trigger animate in
        setTimeout(() => {
          mainContent.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
          mainContent.style.opacity = '1';
          mainContent.style.transform = 'translateX(0)';
        }, 20);
      }, 250);
    }

    function skipQuestion() {
      questionStates[currentQ].skipped = true;
      goToNextAvailable();
    }

    function goToNextAvailable() {
      // Find next unanswered question
      let nextQ = currentQ + 1;
      while (nextQ < questions.length && (questionStates[nextQ].answered || questionStates[nextQ].skipped)) {
        nextQ++;
      }
      
      if (nextQ >= questions.length) {
        // Check if all questions are done
        const allDone = questionStates.every(s => s.answered || s.skipped);
        if (allDone) {
          showScreen('winner');
        } else {
          // Find first unanswered
          nextQ = questionStates.findIndex(s => !s.answered && !s.skipped);
          if (nextQ === -1) {
            showScreen('winner');
          } else {
            currentQ = nextQ;
            optionsShown = false;
            optionsUsed = questionStates[currentQ].optionsUsed || false;
            showScreen('question');
          }
        }
      } else {
        currentQ = nextQ;
        optionsShown = false;
        optionsUsed = questionStates[currentQ].optionsUsed || false;
        showScreen('question');
      }
    }

    function updateReveal() {
      const q = questions[currentQ];
      const state = questionStates[currentQ];
      
      // Update current turn indicator on reveal screen
      const team = teams[currentTeamIndex];
      const revealTurnAvatar = $('revealTurnAvatar');
      if (team.image) {
        revealTurnAvatar.innerHTML = `<img src="${team.image}" alt="${team.name}">`;
      } else {
        revealTurnAvatar.innerHTML = team.icon || 'ðŸŽ¯';
      }
      $('revealTurnName').textContent = team.name;
      
      // Show image if question has one, otherwise show icon
      const ansImageContainer = $('ansImageContainer');
      if (q.image) {
        ansImageContainer.innerHTML = `<img src="${q.image}" alt="Question image" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">`;
      } else {
        ansImageContainer.innerHTML = `<span class="fallback-icon">${q.icon}</span>`;
      }
      $('ansTitle').textContent = q.ans;
      $('ansDesc').innerHTML = q.desc.replace(/\n/g, '<br>');
      
      // Set option letter badge (Option A, B, C, or D)
      const ansIndex = q.opts.indexOf(q.ans);
      const optionLetter = String.fromCharCode(65 + ansIndex); // A, B, C, D
      $('ansBadge').textContent = 'Option ' + optionLetter;
      
      selectedTeamId = null;
      $('mobileActionPanel').classList.remove('show');
      
      const usedOpts = state.optionsUsed || optionsUsed;
      const correctPts = usedOpts ? '+1' : '+2';
      const wrongPts = '-1';
      
      // Update mobile action panel buttons
      $('correctPtsBtn').textContent = correctPts;
      $('wrongPtsBtn').textContent = wrongPts;
      
      // Show/hide next button based on if last question
      $('nextQBtn').style.display = currentQ >= questions.length - 1 ? 'none' : 'inline-block';
      
      // Check if already answered
      if (state.answered) {
        const answeredTeam = teams.find(t => t.id === state.teamId);
        const resultText = state.correct ? 'âœ“ Correct' : 'âœ— Wrong';
        const resultClass = state.correct ? 'correct' : 'wrong';
        const teamAvatarHtml = answeredTeam.image 
          ? `<img src="${answeredTeam.image}" alt="${answeredTeam.name}" class="answered-team-image">`
          : `<span class="answered-team-icon">${answeredTeam.icon}</span>`;
        
        $('teamsGrid').innerHTML = `
          <div class="already-answered">
            <div class="answered-label">Already Answered</div>
            <div class="answered-team">
              ${teamAvatarHtml}
              <span class="answered-team-name"><span class="team-label"><span class="prefix">Team</span> <span class="name">${answeredTeam.name}</span></span></span>
              <span class="answered-result ${resultClass}">${resultText}</span>
            </div>
          </div>
        `;
        $('mobileActionPanel').style.display = 'none';
      } else {
        $('mobileActionPanel').style.display = '';
        
        // Only show the current turn's team
        const t = teams[currentTeamIndex];
        const avatarHtml = t.image 
          ? `<img src="${t.image}" alt="${t.name}" class="team-image">`
          : `<div class="team-icon">${t.icon}</div>`;
        
        $('teamsGrid').innerHTML = `
          <div class="current-team-card">
            <div class="current-team-header">
              ${avatarHtml}
              <div class="current-team-info">
                <div class="current-team-name"><span class="team-label"><span class="prefix">Team</span> <span class="name">${t.name}</span></span></div>
                <div class="current-team-score">${t.score} pts</div>
              </div>
            </div>
            <div class="current-team-actions">
              <button class="score-btn correct" onclick="award(${t.id}, true)">
                <span class="score-pts">${correctPts}</span>
                <span class="score-label">Correct</span>
              </button>
              <button class="score-btn wrong" onclick="award(${t.id}, false)">
                <span class="score-pts">${wrongPts}</span>
                <span class="score-label">Wrong</span>
              </button>
            </div>
          </div>
        `;
        
        // Hide mobile action panel since we have inline buttons now
        $('mobileActionPanel').style.display = 'none';
      }
    }

    function selectTeam(teamId) {
      selectedTeamId = teamId;
      const team = teams.find(t => t.id === teamId);
      
      // Update selection UI
      document.querySelectorAll('.team-card').forEach(c => c.classList.remove('selected'));
      document.querySelector(`.team-card[data-id="${teamId}"]`).classList.add('selected');
      
      // Show mobile action panel
      const iconEl = $('selectedTeamIcon');
      if (team.image) {
        iconEl.innerHTML = `<img src="${team.image}" alt="${team.name}" class="selected-team-img">`;
      } else {
        iconEl.textContent = team.icon;
      }
      $('selectedTeamName').innerHTML = `<span class="team-label"><span class="prefix">Team</span> <span class="name">${team.name}</span></span>`;
      $('mobileActionPanel').classList.add('show');
      
      // Scroll to action panel on mobile
      if (isMobile()) {
        setTimeout(() => {
          $('mobileActionPanel').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    }

    function awardSelected(correct) {
      if (selectedTeamId === null) return;
      award(selectedTeamId, correct);
    }

    function award(teamId, correct) {
      const team = teams.find(t => t.id === teamId);
      const state = questionStates[currentQ];
      const usedOpts = state.optionsUsed || optionsUsed;
      const pts = correct ? (usedOpts ? 1 : 2) : -1;
      team.score += pts;
      
      // Mark question as answered
      state.answered = true;
      state.skipped = false;
      state.teamId = teamId;
      state.correct = correct;
      state.points = pts;
      state.turnTeamId = teams[currentTeamIndex].id; // Track whose turn it was
      
      // Track last answered question
      lastAnsweredQ = currentQ;
      
      showToast(team.icon, team.name, pts);
      updateLiveLeaderboard();
      updateSidePanel();
      updateLastAnsweredInfo();
      
      // Go to next question with animation
      setTimeout(() => {
        goToNextWithAnimation();
      }, 800);
    }

    function goToNextWithAnimation() {
      // Check if all questions done
      const allDone = questionStates.every(s => s.answered || s.skipped);
      if (allDone) {
        showScreen('winner');
        return;
      }
      
      // Advance to next team
      currentTeamIndex = (currentTeamIndex + 1) % teams.length;
      
      // Animate out reveal content
      const revealContent = document.querySelector('.reveal-content');
      if (revealContent) {
        revealContent.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
        revealContent.style.opacity = '0';
        revealContent.style.transform = 'translateX(-50px)';
      }
      
      setTimeout(() => {
        // Switch to question screen with team selection
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        $('question').classList.add('active');
        
        // Show team selection mode
        showTeamSelection();
        
        // Set up initial state for animation in from right
        const mainContent = document.querySelector('.main-content');
        mainContent.style.transition = 'none';
        mainContent.style.opacity = '0';
        mainContent.style.transform = 'translateX(50px)';
        
        // Trigger animation in
        setTimeout(() => {
          mainContent.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
          mainContent.style.opacity = '1';
          mainContent.style.transform = 'translateX(0)';
        }, 20);
        
        // Reset reveal content for next time
        if (revealContent) {
          revealContent.style.transition = 'none';
          revealContent.style.opacity = '1';
          revealContent.style.transform = 'translateX(0)';
        }
      }, 250);
    }

    function skipFromReveal() {
      questionStates[currentQ].skipped = true;
      goToNextWithAnimation();
    }

    function backToQuestion() {
      showScreen('question');
    }

    function goNextQuestion() {
      if (currentQ < questions.length - 1) {
        // Animate left to right: current goes left, new comes from right
        const revealContent = document.querySelector('.reveal-content');
        revealContent.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
        revealContent.style.opacity = '0';
        revealContent.style.transform = 'translateX(-50px)';
        
        setTimeout(() => {
          currentQ++;
          optionsShown = false;
          optionsUsed = questionStates[currentQ].optionsUsed || false;
          
          document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
          $('question').classList.add('active');
          
          const mainContent = document.querySelector('.main-content');
          mainContent.style.transition = 'none';
          mainContent.style.opacity = '0';
          mainContent.style.transform = 'translateX(50px)';
          
          updateQuestion();
          
          setTimeout(() => {
            mainContent.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
            mainContent.style.opacity = '1';
            mainContent.style.transform = 'translateX(0)';
          }, 20);
          
          // Reset reveal content
          revealContent.style.transition = 'none';
          revealContent.style.opacity = '1';
          revealContent.style.transform = 'translateX(0)';
        }, 250);
      }
    }

    function showToast(icon, name, pts, isTeamName = true) {
      $('toastIcon').textContent = icon;
      if (isTeamName) {
        $('toastText').innerHTML = `<span class="team-label"><span class="prefix">Team</span> <span class="name">${name}</span></span>`;
      } else {
        $('toastText').textContent = name;
      }
      const ptsEl = $('toastPts');
      ptsEl.textContent = (pts > 0 ? '+' : '') + pts + ' pts';
      ptsEl.className = 'toast-pts ' + (pts > 0 ? 'pos' : pts < 0 ? 'neg' : 'zero');
      $('toast').classList.add('show');
      setTimeout(() => $('toast').classList.remove('show'), 900);
    }

    function openModal() {
      const maxScore = Math.max(...teams.map(t => t.score));
      $('modalTeams').innerHTML = teams.map((t, i) => `
        <div class="modal-team ${t.score > 0 && t.score === maxScore ? 'top' : ''}">
          <span class="modal-rank">${i + 1}</span>
          <span class="modal-icon">${t.icon}</span>
          <span class="modal-name"><span class="team-label"><span class="prefix">Team</span> <span class="name">${t.name}</span></span></span>
          <span class="modal-pts">${t.score}</span>
        </div>
      `).join('');
      $('modalOverlay').classList.add('show');
    }

    function closeModal() {
      $('modalOverlay').classList.remove('show');
    }

    // Edit Score Modal
    let editState = {
      teamId: null,
      points: 2
    };

    function openEditScoreModal() {
      const state = questionStates[currentQ];
      const q = questions[currentQ];
      
      // Initialize edit state with current values
      editState.teamId = state.teamId;
      editState.points = state.points || 2;
      
      $('editQNum').textContent = currentQ + 1;
      
      // Build team grid
      $('editTeamGrid').innerHTML = teams.map(t => {
        const iconHtml = t.image 
          ? `<img src="${t.image}" alt="${t.name}" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">`
          : `<span class="team-icon">${t.icon}</span>`;
        return `
          <button class="edit-team-btn ${t.id === editState.teamId ? 'selected' : ''}" onclick="setEditTeam(${t.id})">
            ${iconHtml}
            <span class="team-name"><span class="team-label"><span class="prefix">Team</span> <span class="name">${t.name}</span></span></span>
          </button>
        `;
      }).join('');
      
      // Set points buttons
      updateEditPointsButtons();
      updateEditSummary();
      
      $('editScoreModal').classList.add('show');
    }

    function closeEditScoreModal() {
      $('editScoreModal').classList.remove('show');
    }

    function setEditTeam(teamId) {
      editState.teamId = teamId;
      document.querySelectorAll('.edit-team-btn').forEach(btn => btn.classList.remove('selected'));
      document.querySelector(`.edit-team-btn[onclick="setEditTeam(${teamId})"]`).classList.add('selected');
      updateEditSummary();
    }

    function setEditPoints(pts) {
      editState.points = pts;
      updateEditPointsButtons();
      updateEditSummary();
    }

    function updateEditPointsButtons() {
      $('editPts2').classList.toggle('selected', editState.points === 2);
      $('editPts1').classList.toggle('selected', editState.points === 1);
      $('editPtsMinus1').classList.toggle('selected', editState.points === -1);
    }

    function updateEditSummary() {
      const team = teams.find(t => t.id === editState.teamId);
      const pts = editState.points;
      const ptsClass = pts > 0 ? 'positive' : 'negative';
      const ptsDisplay = pts > 0 ? `+${pts}` : pts;
      
      if (team) {
        $('editSummary').innerHTML = `
          <strong><span class="team-label"><span class="prefix">Team</span> <span class="name">${team.name}</span></span></strong> will receive 
          <span class="pts-change ${ptsClass}">${ptsDisplay} pts</span>
        `;
      } else {
        $('editSummary').innerHTML = 'Please select a team';
      }
    }

    function saveEditScore() {
      if (editState.teamId === null) {
        alert('Please select a team');
        return;
      }
      
      const state = questionStates[currentQ];
      const oldTeam = teams.find(t => t.id === state.teamId);
      const newTeam = teams.find(t => t.id === editState.teamId);
      
      // Reverse old score
      if (oldTeam && state.points !== undefined) {
        oldTeam.score -= state.points;
      }
      
      // Apply new score
      const newPts = editState.points;
      newTeam.score += newPts;
      
      // Update state
      state.teamId = editState.teamId;
      state.correct = newPts > 0;
      state.optionsUsed = newPts === 1;
      state.points = newPts;
      
      // Close modal and refresh
      closeEditScoreModal();
      updateQuestion();
      updateSidePanel();
      updateLiveLeaderboard();
      
      showToast(newTeam.icon || 'âœï¸', 'Score Updated', newPts, false);
    }

    // Confetti animation
    function launchConfetti() {
      if (!confettiRunning) return;
      
      const container = $('confettiContainer');
      container.innerHTML = '';
      
      const colors = ['#FFD700', '#FFA500', '#FF6347', '#00CED1', '#9370DB', '#32CD32', '#FF69B4', '#00BFFF'];
      const shapes = ['square', 'circle'];
      
      for (let i = 0; i < 150; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        
        const color = colors[Math.floor(Math.random() * colors.length)];
        const shape = shapes[Math.floor(Math.random() * shapes.length)];
        const left = Math.random() * 100;
        const delay = Math.random() * 3;
        const duration = 3 + Math.random() * 3;
        const size = 8 + Math.random() * 12;
        
        confetti.style.cssText = `
          left: ${left}%;
          width: ${size}px;
          height: ${size}px;
          background: ${color};
          border-radius: ${shape === 'circle' ? '50%' : '2px'};
          animation-delay: ${delay}s;
          animation-duration: ${duration}s;
        `;
        
        container.appendChild(confetti);
        setTimeout(() => confetti.classList.add('active'), 10);
      }
      
      setTimeout(() => {
        if (confettiRunning) launchConfetti();
      }, 4000);
    }

    function updateWinner() {
      const sorted = getSorted();
      const winner = sorted[0];
      
      $('winnerCard').style.background = 'linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%)';
      
      // Handle winner icon/image
      const winIconEl = $('winIcon');
      if (winner.image) {
        winIconEl.innerHTML = `<img src="${winner.image}" alt="${winner.name}" class="winner-image">`;
      } else {
        winIconEl.textContent = winner.icon;
      }
      
      $('winName').innerHTML = `<span class="team-label"><span class="prefix">Team</span> <span class="name">${winner.name}</span></span>`;
      $('winScore').textContent = winner.score + ' points';
      
      $('finalLeaderboard').innerHTML = sorted.map((t, i) => {
        const cls = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
        const iconHtml = t.image 
          ? `<img src="${t.image}" alt="${t.name}" class="final-image">`
          : `<span class="final-icon">${t.icon}</span>`;
        return `
          <div class="final-row ${cls}">
            <span class="final-rank">${getRank(i)}</span>
            ${iconHtml}
            <span class="final-name"><span class="team-label"><span class="prefix">Team</span> <span class="name">${t.name}</span></span></span>
            <span class="final-score">${t.score} pts</span>
          </div>
        `;
      }).join('');
      
      // Launch confetti on first reveal
      if (!confettiShown) {
        confettiRunning = true;
        launchConfetti();
        confettiShown = true;
      }
    }

    function endQuiz() {
      // Check for ties at the top
      const sorted = getSorted();
      const topScore = sorted[0].score;
      const tiedTeams = sorted.filter(t => t.score === topScore);
      
      if (tiedTeams.length > 1) {
        // There's a tie - show tiebreaker
        showScreen('tiebreaker');
      } else {
        showScreen('winner');
      }
    }

    function updateTiebreaker() {
      const sorted = getSorted();
      const topScore = sorted[0].score;
      const tiedTeams = sorted.filter(t => t.score === topScore);
      
      const grid = $('tiedTeamsGrid');
      
      grid.innerHTML = tiedTeams.map(t => {
        const avatarHtml = t.image 
          ? `<img src="${t.image}" alt="${t.name}" class="team-image">`
          : `<div class="team-icon">${t.icon}</div>`;
        return `
          <div class="tiebreaker-team-card">
            <div class="tiebreaker-team-header">
              ${avatarHtml}
              <div class="tiebreaker-team-info">
                <div class="tiebreaker-team-name"><span class="team-label"><span class="prefix">Team</span> <span class="name">${t.name}</span></span></div>
                <div class="tiebreaker-team-score">${t.score} pts</div>
              </div>
            </div>
            <div class="tiebreaker-team-actions">
              <button class="tiebreaker-btn bonus" onclick="tiebreakerAward(${t.id}, true)">
                <span class="tiebreaker-pts">+1</span>
              </button>
              <button class="tiebreaker-btn penalty" onclick="tiebreakerAward(${t.id}, false)">
                <span class="tiebreaker-pts">-1</span>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function tiebreakerAward(teamId, isBonus) {
      const team = teams.find(t => t.id === teamId);
      team.score += isBonus ? 1 : -1;
      
      showToast(team.icon, team.name, isBonus ? 1 : -1);
      
      // Check if tie is broken
      setTimeout(() => {
        const sorted = getSorted();
        const topScore = sorted[0].score;
        const tiedTeams = sorted.filter(t => t.score === topScore);
        
        if (tiedTeams.length === 1) {
          // Tie is broken - go to winner
          showScreen('winner');
        } else {
          // Still tied - update display
          updateTiebreaker();
        }
      }, 500);
    }

    function restart() {
      confettiRunning = false;
      $('confettiContainer').innerHTML = '';
      teams.forEach(t => t.score = 0);
      questionStates.forEach(s => {
        s.answered = false;
        s.skipped = false;
        s.teamId = null;
        s.correct = null;
        s.optionsUsed = false;
        s.points = 0;
        s.turnTeamId = null;
      });
      currentQ = 0;
      optionsShown = false;
      optionsUsed = false;
      selectedTeamId = null;
      confettiShown = false;
      currentTeamIndex = 0;
      questionRevealed = false;
      lastAnsweredQ = -1;
      $('qTotal').textContent = '/ ' + questions.length;
      showScreen('intro');
    }
  </script>
</body>
</html>
